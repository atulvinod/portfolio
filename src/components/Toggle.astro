---
import { Image } from "astro:assets";
import light from "../images/light-mode.png";
import dark from "../images/dark-mode.png";
---

<style>
    .toggle-checkbox {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        display: none;
    }

    .toggle-switch {
        background-color: gray;
        width: 50px;
        height: 22px;
        border-radius: 12px;
        position: relative;
        transition: 0.3s;
        cursor: pointer;
    }

    .toggle-switch::before {
        content: "";
        font-weight: 900;
        background-color: white;
        width: 20px;
        height: 20px;
        position: absolute;
        border-radius: 50%;
        top: 1.1px;
        left: 1px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #ddd;
        transition: 0.3s;
    }

    .toggle-checkbox:checked + .toggle-switch {
        background-color: #d3d4d9;
    }

    .toggle-switch:checked {
        background-color: black;
    }

    .toggle-checkbox:checked + .toggle-switch::before {
        content: "";
        left: 29px;
        color: #0075ff;
        background-color: rgb(17, 24, 39);
    }
</style>
<div class="flex flex-row items-center">
    <Image alt={"light mode"} src={light} class:list={["w-10", "h-10"]} />
    <label class="mx-2">
        <input type="checkbox" class="toggle-checkbox" id="dark-mode-toggle" />
        <div class="toggle-switch"></div>
    </label>
    <Image alt={"dark mode"} src={dark} class:list={["w-9", "h-9"]} />
</div>

<script>
    function setDarkMode() {
        document.documentElement.classList.remove("light");
        document.documentElement.classList.add("dark");
    }

    function setLightMode() {
        document.documentElement.classList.add("light");
        document.documentElement.classList.remove("dark");
    }

    if (
        localStorage.getItem("theme") == "dark" ||
        window.matchMedia("(prefers-color-scheme: dark)").matches
    ) {
        document
            .getElementById("dark-mode-toggle")
            ?.setAttribute("checked", "true");
        setDarkMode();
    } else {
        setLightMode();
    }

    document
        .getElementById("dark-mode-toggle")
        ?.addEventListener("change", function (event) {
            const checkbox = event.target as HTMLInputElement
            const isChecked = checkbox.checked ;
            if (isChecked) {
                setDarkMode();
                localStorage.setItem("theme", "dark");
            } else {
                setLightMode();
                localStorage.setItem("theme", "light");
            }
        });
</script>
